/*
 * Copyright (C) 2009-2020 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["fin/cash/flow/analyzer/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/generic/app/navigation/service/NavigationHandler","fin/cash/flow/analyzer/util/Conversions","fin/cash/flow/analyzer/util/StringUtil","fin/cash/flow/analyzer/controller/ExternalNavigationController","fin/cash/flow/analyzer/controller/CycleController","fin/cash/flow/analyzer/helper/AppSettingsHelper","fin/cash/flow/analyzer/util/ErrorHandler","sap/ui/core/util/File","sap/ui/table/Column"],function(B,J,H,S,N,C,a,E,b,A,d,F,e){"use strict";return B.extend("fin.cash.flow.analyzer.controller.NewHierarchyController",{conversions:C,util:null,oPersonalizer:null,cController:b,aDrilldownfilter:[],oMyView:null,oDataPath:null,oTreeTable:null,oJsonModel:null,oDataToJsonTreeResultBA:{},oDataToJsonTreeResultLQ:{},oDataToJsonTreeResultCP:{},oSelectedPath:null,bIsInitialised:false,onInit:function(){this.oNav=E;this.util=C;this.cycleController=b;this.oNavigationHandler=new N(this);this.oMyView=this.getView().byId("page");this.sortData={};this.oJsonModel=new sap.ui.model.json.JSONModel();this.oWnerComponent=this.getOwnerComponent();this.oResourceBundle=this.oWnerComponent.getModel("i18n").getResourceBundle();this.oDataModel=this.oWnerComponent.getModel();this.oDataModel.setDefaultCountMode(sap.ui.model.odata.CountMode.None);this.setModel(this.oDataModel);this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this.oErrorHandler=d;this.oErrorHandler.initODateErrorHandler(this.oWnerComponent);this.oColumn=e;var p=new sap.ui.model.json.JSONModel({headerExpanded:true});this.getView().setModel(p,"page");if(sap.ui.Device.system.desktop){this.getView().addStyleClass("sapUiSizeCompact");}if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.LiquidityItemHierarchy"){this.sHierType="LQH";this.oDataPath="/FCLM_CFBA_LQH_VIEWSet";this.oCurrSmartFilterBar=this.byId("smartFilterBarItemForLQ");this.getRouter().getRoute("LiquidityItemHierarchy").attachPatternMatched(this.onRefresh,this);}if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.BankAccountHierarchy"){this.sHierType="BKH";this.oDataPath="/FCLM_CFBA_BKH_VIEWSet";this.oCurrSmartFilterBar=this.byId("smartFilterBarItemForBA");this.getRouter().getRoute("BankAccountHierarchy").attachPatternMatched(this.onRefresh,this);}if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.CashConcentrationSim"){this.sHierType="CPS";this.oDataPath="/FCLM_CFBA_CP_SIMSet";this.oCurrSmartFilterBar=this.byId("smartFilterBarItemForCPSim");this.getRouter().getRoute("CashConcentrationSim").attachPatternMatched(this.onRefresh,this);}},onAfterRendering:function(){var t=this;var T;t.oWnerComponent.getService("ShellUIService").then(function(s){if(s){switch(t.sHierType){case"BKH":T=t.oResourceBundle.getText("BAHierarchyViewTitle");break;case"LQH":T=t.oResourceBundle.getText("hierarchyViewTitle");break;case"CPS":T=t.oResourceBundle.getText("CPSimViewTitle");break;}s.setTitle(T);}},function(s){});},storeCurrentAppState:function(){var o=this.oNavigationHandler.storeInnerAppState(this.getCurrentAppState());var t=this;o.fail(function(c){t.arOwnerFilters(c);});},getCurrentAppState:function(){var s=new S(this.oCurrSmartFilterBar.getDataSuiteFormat());if(this.sHierType!=="CPS"){s.removeParameter("CyclePattern");if(this.sHierType==="BKH"){s.addSelectOption("CyclePattern","I","EQ",this.getView().byId("idCyclePatternForBA").getValue());}else{s.addSelectOption("CyclePattern","I","EQ",this.getView().byId("idCyclePatternForLQ").getValue());}}return{selectionVariant:s.toJSONString()};},getCustomAppStateData:function(){var c={CyclePattern:this.oCurrSmartFilterBar.getControlByKey("CyclePattern").getValue()};return c;},generateCustomUrl:function(){this.storeCurrentAppState();return document.URL;},onRefresh:function(o){var c=o.getParameter("arguments");var n=null;if(c){n=JSON.parse(String.fromBase64URI(c.Params));}n=$.extend({oDrilldownfilter:null},n);this.aDrilldownfilter=n.oDrilldownfilter;var h=sap.ui.core.routing.History.getInstance();if(h.getDirection()!=="Backwards"){if(this.oCurrSmartFilterBar.isInitialised()===true&&this.bIsInitialised===false&&!this.oShareActionSheet===true){this.initAppState();}}},onInitSmartFilterBar:function(){if(this.oCurrSmartFilterBar.isInitialised()===true&&this.bIsInitialised===false){this.initAppState();}},initAppState:function(){var p=this.oNavigationHandler.parseNavigation();var t=this;var s=null;var h=this.sHierType;p.done(function(o,u,n){this.bIsInitialised=true;switch(n){case sap.ui.generic.app.navigation.service.NavType.iAppState:if(h!=="CPS"){s=new sap.ui.generic.app.navigation.service.SelectionVariant(o.selectionVariant);var v=s.getValue("KeyDate");var l=s.getValue("CyclePattern");var m=s.getValue("HistoricalTimeStamp");var q=s.getValue("DateIndicator");var f=JSON.parse(t.aDrilldownfilter);var c=[];c.length=0;t.FromMainView=false;t.SortOrder="";for(var i=0;i<f.Parameters.length;i++){if(f.Parameters[i].PropertyName==="FromMainView"){t.FromMainView=true;continue;}c.push(f.Parameters[i].PropertyName);}for(i=0;i<f.SelectOptions.length;i++){if(f.SelectOptions[i].PropertyName==="SortOrder"){t.SortOrder=f.SelectOptions[i].Ranges[0].Low;continue;}c.push(f.SelectOptions[i].PropertyName);}var r=t.oCurrSmartFilterBar.getAllFilterItems();for(i=0;i<r.length;i++){var w=r[i].getName();for(var j=0;j<c.length;j++){if(w===c[j]){r[i].setVisibleInFilterBar(true);}}}if(t.util.isNull(v)){s.addSelectOption("KeyDate","I","EQ",t.util.getValueDateDefault());}if(t.util.isNull(l)){s.addSelectOption("CyclePattern","I","EQ","D7");}if(t.util.isNull(m)){s.addSelectOption("HistoricalTimeStamp","I","EQ",t.util.getHistoryDateTimeDefault());}t.oCurrSmartFilterBar.getControlByKey("HistoricalTimeStamp").setDateValue(new Date(Date.parse(s.getValue("HistoricalTimeStamp")[0].Low)));t.oCurrSmartFilterBar.getControlByKey("CyclePattern").setValue(s.getValue("CyclePattern")[0].Low);if(t.util.isNull(q)){s.addSelectOption("DateIndicator","I","EQ","1");}o.selectionVariant=s.toJSONString();}t.oCurrSmartFilterBar.setDataSuiteFormat(o.selectionVariant);t.getPersonalSettings();break;default:var f=JSON.parse(t.aDrilldownfilter);var c=[];c.length=0;t.FromMainView=false;for(var i=0;i<f.Parameters.length;i++){if(f.Parameters[i].PropertyName==="FromMainView"){t.FromMainView=true;continue;}c.push(f.Parameters[i].PropertyName);}for(i=0;i<f.SelectOptions.length;i++){if(f.SelectOptions[i].PropertyName==="SortOrder"){t.SortOrder=f.SelectOptions[i].Ranges[0].Low;continue;}c.push(f.SelectOptions[i].PropertyName);}r=t.oCurrSmartFilterBar.getAllFilterItems();for(i=0;i<r.length;i++){w=r[i].getName();for(j=0;j<c.length;j++){if(w===c[j]){r[i].setVisibleInFilterBar(true);}}}t.oCurrSmartFilterBar.clearVariantSelection();t.oCurrSmartFilterBar.clear();t.oCurrSmartFilterBar.setDataSuiteFormat(t.aDrilldownfilter,true);var g=new sap.ui.generic.app.navigation.service.SelectionVariant(t.aDrilldownfilter);if(t.sHierType!=="CPS"){var k=JSON.parse(t.aDrilldownfilter).Parameters;for(i=0;i<k.length;i++){if(k[i].PropertyName==="CyclePattern"){if(t.sHierType==="BKH"){t.getView().byId("idCyclePatternForBA").setValue(k[i].PropertyValue);}if(t.sHierType==="LQH"){t.getView().byId("idCyclePatternForLQ").setValue(k[i].PropertyValue);}}if(k[i].PropertyName==="HistoricalTimeStamp"){if(t.sHierType==="BKH"){if(k[i].PropertyValue){t.getView().byId("idHistoricalTimeStampForBA").setDateValue(new Date(Date.parse(k[i].PropertyValue)));}else{t.getView().byId("idHistoricalTimeStampForBA").setDateValue(t.util.getHistoryDateTimeDefault());}}if(t.sHierType==="LQH"){if(k[i].PropertyValue){t.getView().byId("idHistoricalTimeStampForLQ").setDateValue(new Date(Date.parse(k[i].PropertyValue)));}else{t.getView().byId("idHistoricalTimeStampForLQ").setDateValue(t.util.getHistoryDateTimeDefault());}}}}if(!g.getValue("ExRateType")){g.addSelectOption("ExRateType","I","EQ","M");t.oCurrSmartFilterBar.setDataSuiteFormat(g.toJSONString(),true);}}else{if(!g.getValue("ExchangeRateType")){g.addSelectOption("ExchangeRateType","I","EQ","M");t.oCurrSmartFilterBar.setDataSuiteFormat(g.toJSONString(),true);}}t.getPersonalSettings();break;}});},setRequestFilters:function(f){var o=null;var v=null;var V=null;if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.BankAccountHierarchy"){v=this.getView().byId("idCyclePatternForBA").getValue();V=this.getView().byId("idHistoricalTimeStampForBA").getDateValue();}if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.LiquidityItemHierarchy"){v=this.getView().byId("idCyclePatternForLQ").getValue();V=this.getView().byId("idHistoricalTimeStampForLQ").getDateValue();}if(v){o=new sap.ui.model.Filter("HistoricalTimeStamp","EQ",this.util.formatUTCDateString(V));}else{o=new sap.ui.model.Filter("HistoricalTimeStamp","EQ",this.util.formatUTCDateString(new Date()));}f.push(o);var s=new sap.ui.generic.app.navigation.service.SelectionVariant(this.oCurrSmartFilterBar.getDataSuiteFormat());var r=s.getParameter("ReleaseFlag");if(r!==undefined){if(parseInt(r)===0){var c=new sap.ui.model.Filter("ReleaseStatus",'EQ',"");f.push(c);}}var g="";var h=new sap.ui.model.Filter("ReconcliationStatus","EQ","0");if(f[0].aFilters){var l=f[0].aFilters.length;for(var i=0;i<l;i++){var j=f[0].aFilters[i].aFilters;if(j){if(j[0].sPath==="ReconcliationStatus"){j.push(h);g="X";}}}}if(g===""){f.push(h);}if(V){o=new sap.ui.model.Filter("CyclePattern","EQ",v);}else{o=new sap.ui.model.Filter("CyclePattern","EQ","D7");}f.push(o);var k=f[0];var m=false;var n=false;if(k._bMultiFilter===false){if(k.sPath==="DisplayCurrency"){m=true;}}else{var p=k.aFilters;for(var i=0;i<p.length;i++){if(p[i].sPath==="DisplayCurrency"){m=true;}if(p[i].sPath==="ExRateType"){n=true;}}}if(m===true&&n===false){o=new sap.ui.model.Filter("ExRateType","EQ","M");f.push(o);}if(this.sHierType==="LQH"&&m===false){this.oMyView.setBusy(false);return;}var q=JSON.parse(this.aDrilldownfilter);for(i=0;i<q.SelectOptions.length;i++){if(q.SelectOptions[i].PropertyName==="SortOrder"){o=new sap.ui.model.Filter("SortOrder","EQ",q.SelectOptions[i].Ranges[0].Low+"%");f.push(o);}}o=new sap.ui.model.Filter("Calendar",sap.ui.model.FilterOperator.EQ,this.getView().getModel("Scaling").getData().factoryCalendarId);f.push(o);o=new sap.ui.model.Filter("PreviousFlag",sap.ui.model.FilterOperator.EQ,this.getView().getModel("Scaling").getData().previousFlag);f.push(o);if(this.sHierType==="BKH"){o=new sap.ui.model.Filter("IsBankCurrency",sap.ui.model.FilterOperator.EQ,"X");}else{o=new sap.ui.model.Filter("IsBankCurrency",sap.ui.model.FilterOperator.EQ,this.getView().getModel("Scaling").getData().isBankCurrency);}f.push(o);if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.LiquidityItemHierarchy"){if(this.FromMainView){o=new sap.ui.model.Filter("ViewType",sap.ui.model.FilterOperator.EQ,2);}else{o=new sap.ui.model.Filter("ViewType",sap.ui.model.FilterOperator.EQ,1);}f.push(o);}},sendRequest:function(){var p=this.oDataPath;var m=this.oDataModel;var f=this.oCurrSmartFilterBar.getFilters();if(m){this.oMyView.setBusy(true);if(this.getView().getViewName()!=="fin.cash.flow.analyzer.view.CashConcentrationSim"){this.setRequestFilters(f);}m.read(p,{filters:f,success:$.proxy(this.handleMyTableDataRefreshReady,this),error:$.proxy(this.handleMyTableDataFailed,this)});}},sendHeaderRequest:function(){var m=this.oDataModel;if(m){var f=null;var c=[];var p="";if(this.sHierType==="BKH"){p="/FCLM_CFBA_BKH_VHSet";var g=this.oCurrSmartFilterBar.getFilters()[0];var h="";if(g._bMultiFilter===false){if(g.sPath==="BankAccountGroup"){h=g.oValue1;}}else{var j=g.aFilters;for(var i=0;i<j.length;i++){if(j[i].sPath==="BankAccountGroup"){h=j[i].oValue1;}}}f=new sap.ui.model.Filter("HierarchyName",sap.ui.model.FilterOperator.EQ,h);c.push(f);}if(this.sHierType==="LQH"){p="/FCLM_CFBA_LQH_VHSet";g=this.oCurrSmartFilterBar.getFilters()[0];var L="";if(g._bMultiFilter===false){if(g.sPath==="LiquidityHierarchyName"){L=g.oValue1;}}else{j=g.aFilters;for(i=0;i<j.length;i++){if(j[i].sPath==="LiquidityHierarchyName"){L=j[i].oValue1;}}}f=new sap.ui.model.Filter("HierarchyName",sap.ui.model.FilterOperator.EQ,L);c.push(f);}if(this.sHierType==="CPS"){p="/FCLM_CFBA_CP_VHSet";g=this.oCurrSmartFilterBar.getFilters()[0];var k="";if(g._bMultiFilter===false){if(g.sPath==="HierarchyName"){k=g.oValue1;}}else{j=g.aFilters;for(i=0;i<j.length;i++){if(j[i].sPath==="HierarchyName"){k=j[i].oValue1;}}}f=new sap.ui.model.Filter("CashPoolName",sap.ui.model.FilterOperator.EQ,k);c.push(f);}m.read(p,{filters:c,success:$.proxy(this.handleHeaderReady,this),error:$.proxy(this.handleMyTableDataFailed,this)});}},handleHeaderReady:function(D){if(this.sHierType==="BKH"){if(D.results.length!==0){this.extendTreeTable(this.oResourceBundle.getText("BAHID")+" : "+D["results"][0].HierarchyText);}}if(this.sHierType==="CPS"){if(D.results.length!==0){this.extendTreeTable(this.oResourceBundle.getText("CPID")+": "+D["results"][0].CashPoolDesc);}}if(this.sHierType==="LQH"&&this.FromMainView===true){if(D.results.length!==0){this.extendTreeTable(this.oResourceBundle.getText("LHH")+" : "+D["results"][0].HierarchyText);}}if(this.sHierType==="LQH"&&this.FromMainView===false){if(D.results.length!==0){this.liquidityHierarchy=D["results"][0].HierarchyText;}var m=this.oDataModel;if(m){var f=null;var c=[];var p="";p="/FCLM_CFBA_BKH_VHSet";var g=this.oCurrSmartFilterBar.getFilters()[0];var h="";if(g._bMultiFilter===false){if(g.sPath==="BankAccountGroup"){h=g.oValue1;}}else{var j=g.aFilters;for(var i=0;i<j.length;i++){if(j[i].sPath==="BankAccountGroup"){h=j[i].oValue1;}}}f=new sap.ui.model.Filter("HierarchyName",sap.ui.model.FilterOperator.EQ,h);c.push(f);m.read(p,{filters:c,success:$.proxy(this.handleHeaderHNReady,this),error:$.proxy(this.handleMyTableDataFailed,this)});}}},handleHeaderHNReady:function(D){if(D.results.length!==0){this.extendTreeTable(this.oResourceBundle.getText("BAHID")+" : "+D["results"][0].HierarchyText+" / "+this.oResourceBundle.getText("LHH")+" : "+this.liquidityHierarchy);}else{if(this.liquidityHierarchy!==undefined){this.extendTreeTable(this.oResourceBundle.getText("LHH")+" : "+this.liquidityHierarchy);}}},getPersonalSettings:function(){var p=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("Personalization");if(p){var P={container:"fin.cash.flow.analyzer"+((sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getUser().getId())||{}),item:"favorites"};this.oPersonalizer=p.getPersonalizer(P);this.oAppSettingsHelper=new A(this.getModel(),this.getView(),this,this.oPersonalizer);}this.getUserSetting();},getUserSetting:function(){var t=this;t.oAppSettingsHelper.asyncGetSettings(function(s){var c=(s.Scaling)?(s.Scaling):0;var f=(s.SettingExpendLevel)?(s.SettingExpendLevel):3;var g=(s.SettingDisplayCurrency)?(s.SettingDisplayCurrency):"";var i;if(s.DB_IsBankCurrency!==undefined&&s.DB_IsBankCurrency!==null){switch(s.DB_IsBankCurrency){case 0:i="";this.rbIsBankCurrency="0";break;case 1:i="X";this.rbIsBankCurrency="1";break;case 2:i="L";this.rbIsBankCurrency="2";break;}}else{i="";this.rbIsBankCurrency="0";}var h=(s.FactoryCalendarId&&s.WorkingRadioBtn&&s.WorkingRadioBtn===1)?(s.FactoryCalendarId):"*";var p=(s.PreviousFlag&&s.WorkingRadioBtn&&s.WorkingRadioBtn===1)?(s.PreviousFlag):"1";var o=new J({scaling:c,expend:f,displayCurrency:g,isBankCurrency:i,factoryCalendarId:h,previousFlag:p});this.getView().setModel(o,"Scaling");this.sendRequest();},function(){var s=new J({scaling:0,expend:3,factoryCalendarId:"*",previousFlag:"1"});this.getView().setModel(s,"Scaling");this.sendRequest();},this);},handleMyTableDataFailed:function(c){this.oMyView.setBusy(false);this.showMessageBoxForODataError(c,this.oResourceBundle.getText("READ_TABLE_DATA_FAILED"));},handleMyTableDataRefreshReady:function(D){var t=this;this.oMyView.setBusy(false);try{if(this.sHierType==="BKH"){if(D.results.length!==0){var c=this.getColumnTextAry(D);}if(D.results.length!==0){this.bnkDsplyCrcyConvertoDataToJson(D);}else{this.oDataToJsonTreeResultBA={};}var l=new sap.ui.comp.navpopover.SmartLink({text:"{name}",semanticObject:"BankAccount",additionalSemanticObjects:"BankStatement",semanticObjectLabel:"{i18n>NAVIGATION}",mapFieldToSemanticObject:false,beforePopoverOpens:function(i){t.oNav.onBeforePopoverOpensBACC(i,t);},navigationTargetsObtained:function(i){t.oNav.onTargetObtainedBACC(i,t);},innerNavigate:function(i){t.oNav.onPopoverLinkPressedBACC(i,t);}});this.aTableCols=[];this.aTableCols.push(new this.oColumn({width:"250px",label:this.oResourceBundle.getText("BNKBNKACCNM"),template:l}));l=new sap.m.Label({text:"{description}",hAlign:"Left"});this.aTableCols.push(new this.oColumn({width:"150px",label:this.oResourceBundle.getText("Description"),template:l,hAlign:"Left"}));l=new sap.m.Label({text:"{currency}",hAlign:"Left"});if(D.results.length!==0){this.createBATableColumns(c);}var f=new sap.m.Button({press:function(i){t.onInterNavigationPressed(i,t);},icon:"sap-icon://org-chart"});var o=new this.oColumn({hAlign:"Center",width:"70px",template:f});var m=new sap.m.Label({text:this.oResourceBundle.getText("BLNavigationShort"),hAlign:"Left",width:"50px"});m.setTooltip(this.oResourceBundle.getText("BLNavigation"));o.removeAllMultiLabels();o.insertMultiLabel(m,0);this.aTableCols.push(o);}if(this.sHierType==="LQH"){if(D.results.length!==0){c=this.getColumnTextAry(D);}if(D.results.length!==0){this.bnkDsplyCrcyConvertoDataToJson(D);}else{this.oDataToJsonTreeResultLQ={};}l=new sap.m.Label({text:"{name}"});this.aTableCols=[];this.aTableCols.push(new this.oColumn({width:"300px",label:this.oResourceBundle.getText("LQITEM"),template:l}));if(D.results.length!==0){this.createBATableColumns(c);}}if(this.sHierType==="CPS"){if(D.results.length!==0){this.bnkDsplyCrcyConvertoDataToJson(D);}else{this.oDataToJsonTreeResultCP={};}l=new sap.ui.comp.navpopover.SmartLink({text:"{name}",semanticObject:"BankAccount",additionalSemanticObjects:"BankStatement",semanticObjectLabel:"{i18n>NAVIGATION}",mapFieldToSemanticObject:false,beforePopoverOpens:function(i){t.oNav.onBeforePopoverOpensBACC(i,t);},navigationTargetsObtained:function(i){t.oNav.onTargetObtainedBACC(i,t);},innerNavigate:function(i){t.oNav.onPopoverLinkPressedBACC(i,t);}});this.aTableCols=[];this.aTableCols.push(new sap.ui.table.Column({width:"300px",label:this.oResourceBundle.getText("BNKBNKACCNM"),template:l}));l=new sap.m.Label({text:"{description}",hAlign:"Left"});this.aTableCols.push(new sap.ui.table.Column({width:"150px",label:this.oResourceBundle.getText("Description"),template:l,hAlign:"Left"}));l=new sap.m.Label({text:"{cashPool}",hAlign:"Left"});this.aTableCols.push(new sap.ui.table.Column({width:"150px",label:this.oResourceBundle.getText("CPID"),template:l,hAlign:"Left"}));l=new sap.m.Label({text:"{path:'bankaccountCurrency'}",tooltip:"{path:'bankaccountCurrency'}"});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("BankAccountCurrency"),template:l,hAlign:"Left"}));l=new sap.m.Label({text:"{path:'beforeBalance'}",tooltip:"{path:'beforeBalance'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("BeforeBalance"),template:l,hAlign:"Right"}));l=new sap.m.Label({text:"{path:'beforeBalanceDsp'}",tooltip:"{path:'beforeBalanceDsp'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("BeforeBalanceDsp"),template:l,hAlign:"Right"}));l=new sap.m.Label({text:"{path:'afterBalance'}",tooltip:"{path:'afterBalance'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("AfterBalance"),template:l,hAlign:"Right"}));l=new sap.m.Label({text:"{path:'afterBalanceDsp'}",tooltip:"{path:'afterBalanceDsp'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("AfterBalanceDsp"),template:l,hAlign:"Right"}));l=new sap.m.Label({text:"{path:'transferAmount'}",tooltip:"{path:'transferAmount'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("TransferAmount"),template:l,hAlign:"Right"}));l=new sap.m.Label({text:"{path:'maxTargetAmount'}",tooltip:"{path:'maxTargetAmount'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("MaxTargetAmount"),template:l,hAlign:"Right"}));l=new sap.m.Label({text:"{path:'minTransferAmount'}",tooltip:"{path:'minTransferAmount'}",});this.aTableCols.push(new sap.ui.table.Column({width:"200px",label:this.oResourceBundle.getText("MinTransferAmount"),template:l,hAlign:"Right"}));}var g=0;if(this.sHierType==="BKH"){g=3;}else if(this.sHierType==="LQH"||this.sHierType==="CPS"){g=1;}this.oTreeTable=new sap.ui.table.TreeTable({width:"auto",editable:false,columns:this.aTableCols,selectionMode:sap.ui.table.SelectionMode.Single,fixedColumnCount:g,visibleRowCountMode:"Auto",expandFirstLevel:false});this.oTreeTable.setNoData(this.oResourceBundle.getText("NO_RESULT"));this.oTreeTable.addStyleClass("sapUiSizeCondensed");if(this.sHierType==="BKH"){this.oJsonModel.setData(this.oDataToJsonTreeResultBA);}if(this.sHierType==="LQH"){this.oJsonModel.setData(this.oDataToJsonTreeResultLQ);}if(this.sHierType==="CPS"){this.oJsonModel.setData(this.oDataToJsonTreeResultCP);}this.oTreeTable.setModel(this.oJsonModel);this.oTreeTable.bindRows("/root");this.oTreeTable.expandToLevel(0);this.sendHeaderRequest();}catch(h){this.handleMyTableDataFailed(h);}},extendTreeTable:function(t){var o=new sap.m.Button({icon:"sap-icon://excel-attachment",tooltip:"{i18n>TABLE_EXPORT_TEXT}",press:jQuery.proxy(function(){this.ExportExcel();},this)});var c=new sap.m.Button({icon:"sap-icon://expand-group",press:jQuery.proxy(function(){this.oTreeTable.expandToLevel(10);},this)});var f=new sap.m.Button({icon:"sap-icon://collapse-group",press:jQuery.proxy(function(){this.oTreeTable.collapseAll();},this)});var n=new sap.m.Button({icon:"sap-icon://navigation-right-arrow",tooltip:"{i18n>NEXTCYCLE}",press:jQuery.proxy(function(){var i=this;this.cycleController.onCalculateValueDate(true,i);},this)});var p=new sap.m.Button({icon:"sap-icon://navigation-left-arrow",tooltip:"{i18n>PREVIOUSCYCLE}",press:jQuery.proxy(function(){var i=this;this.cycleController.onCalculateValueDate(false,i);},this)});var s=this.oCurrSmartFilterBar.getFilterData(true).EndofPeriod;var g=this.getView().getModel("Scaling").getData().factoryCalendarId;if(s||g!=="*"){p.setEnabled(false);}else{p.setEnabled(true);}var T=new sap.m.ToolbarSpacer();if(this.sHierType==='CPS'){var h=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[T,c,f,o]});}else{h=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[T,p,n,c,f,o]});}h.addStyleClass("tablesubtitle");this.oTreeTable.destroyExtension();this.oTreeTable.addExtension(h);this.oTreeTable.setTitle(t);var P=this.getView().byId("page");P.destroyContent(1);P.setContent(this.oTreeTable,1);if(this.getView().getModel("Scaling").getData().expend){this.oTreeTable.expandToLevel(this.getView().getModel("Scaling").getData().expend);}},createBATableColumns:function(c){var t=this;var l=this.getVisiableColumn();for(var i=0;i<l;i++){var s=this.util.convertHierarchyColumnHeader(c["TextData"+JSON.stringify(i+1)]);if(this.sHierType==="BKH"){var f="{parts:[{path:'Data"+JSON.stringify(i+1)+"'}]}";var g=f;var L=new sap.ui.comp.navpopover.SmartLink({text:f,tooltip:g,semanticObject:"BankAccount",semanticObjectLabel:"{i18n>NAVIGATION}",mapFieldToSemanticObject:false,beforePopoverOpens:function(h){t.oNav.onBeforePopoverOpens(h,t);},navigationTargetsObtained:function(h){t.oNav.onTargetObtained(h,t);},innerNavigate:function(h){t.oNav.onPopoverLinkPressed(h,t);}});var o=new this.oColumn({hAlign:"Right",width:"180px",template:L});var m=new sap.m.Label({text:s.label,textAlign:"Center",width:"180px"});m.setTooltip(s.sTooltip);o.removeAllMultiLabels();o.insertMultiLabel(m,0);this.aTableCols.push(o);}if(this.getDisplayCurrency()===true){f="{parts:[{path:'ConvertData"+JSON.stringify(i+1)+"'}]}";g=f;if(this.sHierType==="LQH"){L=new sap.ui.comp.navpopover.SmartLink({text:f,tooltip:g,semanticObject:"BankAccount",semanticObjectLabel:"{i18n>NAVIGATION}",mapFieldToSemanticObject:false,beforePopoverOpens:function(h){t.oNav.onBeforePopoverOpens(h,t);},navigationTargetsObtained:function(h){t.oNav.onTargetObtained(h,t);},innerNavigate:function(h){t.oNav.onPopoverLinkPressed(h,t);}});}else{L=new sap.m.Label({emphasized:false,text:f,tooltip:g});}o=new this.oColumn({hAlign:"Right",width:"180px",template:L});m=new sap.m.Label({text:s.labelDsply,textAlign:"Center",width:"180px"});m.setTooltip(s.sTooltipDsply);o.removeAllMultiLabels();o.insertMultiLabel(m,0);this.aTableCols.push(o);}}},getDisplayCurrency:function(){var c=false;var f=this.oCurrSmartFilterBar.getFilters()[0];if(f._bMultiFilter===false){if(f.sPath==="DisplayCurrency"){c=true;}else{c=false;}}else{var g=f.aFilters;for(var i=0;i<g.length;i++){if(g[i].sPath==="DisplayCurrency"){return true;}}}return c;},getVisiableColumn:function(){var l=0;var v=null;if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.BankAccountHierarchy"){v=this.getView().byId("idCyclePatternForBA").getValue();}if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.LiquidityItemHierarchy"){v=this.getView().byId("idCyclePatternForLQ").getValue();}if(v){var c=v.split("+");for(var j=0;j<c.length;j++){l=l+(parseInt(c[j].substr(1,2),10));}l=l;}return l;},getColumnTextAry:function(D){var f=D.results[0];var c=[];c["TextData1"]=f.TextData1;c["TextData2"]=f.TextData2;c["TextData3"]=f.TextData3;c["TextData4"]=f.TextData4;c["TextData5"]=f.TextData5;c["TextData6"]=f.TextData6;c["TextData7"]=f.TextData7;c["TextData8"]=f.TextData8;c["TextData9"]=f.TextData9;c["TextData10"]=f.TextData10;c["TextData11"]=f.TextData11;c["TextData12"]=f.TextData12;c["TextData13"]=f.TextData13;c["TextData14"]=f.TextData14;c["TextData15"]=f.TextData15;c["TextData16"]=f.TextData16;c["TextData17"]=f.TextData17;c["TextData18"]=f.TextData18;c["TextData19"]=f.TextData19;c["TextData20"]=f.TextData20;c["TextData21"]=f.TextData21;c["TextData22"]=f.TextData22;c["TextData23"]=f.TextData23;c["TextData24"]=f.TextData24;c["TextData25"]=f.TextData25;c["TextData26"]=f.TextData26;c["TextData27"]=f.TextData27;c["TextData28"]=f.TextData28;c["TextData29"]=f.TextData29;c["TextData30"]=f.TextData30;c["TextData31"]=f.TextData31;c["TextData32"]=f.TextData32;var o=[];var g="TextData";var n=1;var h=g+n.toString();while(f[h]!==""){var i={field:"",from:"",to:""};var s=f[h].split(";");if(s.length===4){var j=s[2];var k=s[3];j=j.substr(1,4)+"-"+j.substr(5,2)+"-"+j.substr(7,2);k=k.substr(1,4)+"-"+k.substr(5,2)+"-"+k.substr(7,2);var l=new Date(j);l=this.util.convertUTCDateToBrowerDate(l);var m=new Date(k);m=this.util.convertUTCDateToBrowerDate(m);i.field=h;if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.BankAccountHierarchy"){i.field=i.field.replace("TextData","Data");}else if(this.getView().getViewName()==="fin.cash.flow.analyzer.view.LiquidityItemHierarchy"){i.field=i.field.replace("TextData","ConvertData");}i.from=l;i.to=m;o.push(i);}n=n+1;h=g+n.toString();}var p=new J(o);this.getView().setModel(p,"FieldMapping");return c;},sortoDataResult:function(r){var s=[];s=r;var f=function(o,c){var v=o.SortOrder.split(".");var V=c.SortOrder.split(".");var g=null;for(var i=0;i<v.length;i++){if(i===0){g=parseInt(v[i],10).toString();}else{g=g+parseInt(v[i],10).toString();}}if(o.IsData==="X"&&o.IsTransactionCur==="X"){g=g+"0";}var n=parseInt(g,10);for(var j=0;j<V.length;j++){if(j===0){g=parseInt(V[j],10).toString();}else{g=g+parseInt(V[j],10).toString();}}if(c.IsData==="X"&&c.IsTransactionCur==="X"){g=g+"0";}var h=parseInt(g,10);return n-h;};s.sort(f);return s;},bnkDsplyCrcyConvertoDataToJson:function(D){var p=this.getView().getModel("Scaling").getData().scaling;var c=this.getVisiableColumn();var f="";var o={};D["results"]=this.sortoDataResult(D["results"]);this.sortData=D["results"];this.oDataOrg=D;var g=null;var l=0;var t={};for(var i=0;i<D["results"].length;i++){if(this.sHierType==="LQH"){f=D["results"][i].LiquidityItemText;if(f===""){f=D["results"][i].LiquidityItem;}}else if(this.sHierType==="BKH"){f=D["results"][i].SText;}else if(this.sHierType==="CPS"){f=D["results"][i].BankAccount;}else if(this.sHierType===''){}if(f===""||f==="#NO_ASGN"){f=this.oResourceBundle.getText("NotAssign");}if(D["results"][i].IsData==="X"&&D["results"][i].IsTransactionCur==="X"){var s=D["results"][i].SortOrder;if(t[s]===null||t[s]===undefined){t[s]=0;}else{t[s]=t[s]+1;}D["results"][i].SortOrder=D["results"][i].SortOrder+"."+t[s].toString();}var n=D["results"][i].SortOrder.split(".");var h=[];for(var j=0;j<n.length;j++){h.push(parseInt(n[j],10));}if(h[0]>l){l=h[0];}var L=h.length.toString();var k=null;if(this.sHierType==="BKH"){k={name:D["results"][i].HierarchyNodeId,icon:this.util.getHierarchyIcon(D["results"][i].IsData,this.sHierType),currency:D["results"][i].BankAccountCurrency,displayCurrency:D["results"][i].DisplayCurrency,sortid:D["results"][i].SortOrder,description:f,checked:true,level:L,BankAccount:D["results"][i].BankAccount,BankAccountName:D["results"][i].BankAccountName,btn_visible:true,newDataNode:false,isData:D["results"][i].IsData,isTransactionCur:D["results"][i].IsTransactionCur,AccId:D["results"][i].AccId};if(D["results"][i].IsData!=="X"){k.currency="";}if(D["results"][i].IsData==="X"&&D["results"][i].IsTransactionCur==="X"){k.name=k.currency;k.newDataNode=true;}if(D["results"][i].IsData==="X"&&D["results"][i].IsTransactionCur!=="X"){k.currency="";}}if(this.sHierType==="LQH"){k={name:f,icon:this.util.getHierarchyIcon(D["results"][i].IsData,this.sHierType),displayCurrency:D["results"][i].DisplayCurrency,sortid:D["results"][i].SortOrder,description:f,checked:true,level:L,LiquidityItem:D["results"][i].LiquidityItem,IsData:D["results"][i].IsData,btn_visible:true};}if(this.sHierType==="CPS"){k={name:f,icon:this.util.getHierarchyIcon(D["results"][i].IsData,this.sHierType),sortid:D["results"][i].SortOrder,description:D["results"][i].BankAccountDesc,cashPool:D["results"][i].CashPoolDesc,bankaccountCurrency:D["results"][i].Currency,displayCurrency:D["results"][i].DisplayCurrency,checked:true,level:L,beforeBalance:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].BeforeBalance,D["results"][i].Currency,p),beforeBalanceDsp:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].BeforeBalanceDsp,D["results"][i].DisplayCurrency,p),transferAmount:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].TransferAmount,D["results"][i].Currency,p),transferAmountDsp:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].TransferAmountDsp,D["results"][i].DisplayCurrency,p),maxTargetAmount:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].MaxTargetAmount,D["results"][i].Currency,p),minTransferAmount:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].MinTransferAmount,D["results"][i].Currency,p),afterBalance:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].AfterBalance,D["results"][i].Currency,p),afterBalanceDsp:this.conversions.formatAmountWithBankAccountCurrency(D["results"][i].AfterBalanceDsp,D["results"][i].DisplayCurrency,p),IsData:D["results"][i].IsData,btn_visible:false,AccId:D["results"][i].BankAccountId};}for(j=0;j<c;j++){var P='Data'+JSON.stringify(j+1);var m='ConvertData'+JSON.stringify(j+1);k[P]=this.conversions.formatAmountWithBankAccountCurrency(D["results"][i][P],k.currency,p);k[m]=this.conversions.formatAmountWithBankAccountCurrencyS(D["results"][i][m],D["results"][i]["DisplayCurrency"],p);}if(this.sHierType==='LQH'&&this.FromMainView===false){if(h.length===1&&h[0]===0){if(D["results"][i].ViewTypeExt==="1BEG_BAL"){k.name=this.oResourceBundle.getText("BEGINNINGBAL");o[h[0]]=k;}if((D["results"][i].ViewTypeExt==="3END_BAL")){k.name=this.oResourceBundle.getText("ENDINGBAL");g=k;}continue;}}if((this.sHierType==='LQH'||this.sHierType==='BKH'||this.sHierType==='CPS')){switch(h.length){case 1:if(this.sHierType==='LQH'&&this.FromMainView===true&&h[0]===0){continue;}o[h[0]]=k;break;case 2:o[h[0]][h[1]]=k;break;case 3:o[h[0]][h[1]][h[2]]=k;break;case 4:o[h[0]][h[1]][h[2]][h[3]]=k;break;case 5:o[h[0]][h[1]][h[2]][h[3]][h[4]]=k;break;case 6:o[h[0]][h[1]][h[2]][h[3]][h[4]][h[5]]=k;break;case 7:o[h[0]][h[1]][h[2]][h[3]][h[4]][h[5]][h[6]]=k;break;case 8:o[h[0]][h[1]][h[2]][h[3]][h[4]][h[5]][h[6]][h[7]]=k;break;case 9:o[h[0]][h[1]][h[2]][h[3]][h[4]][h[5]][h[6]][h[7]][h[8]]=k;break;case 10:o[h[0]][h[1]][h[2]][h[3]][h[4]][h[5]][h[6]][h[7]][h[8]][h[9]]=k;break;default:}}}if(g){o[l+1]=g;}if(this.sHierType==="BKH"){this.oDataToJsonTreeResultBA["root"]=o;}if(this.sHierType==="LQH"){this.oDataToJsonTreeResultLQ["root"]=o;}if(this.sHierType==="CPS"){this.oDataToJsonTreeResultCP["root"]=o;}},valueOf:function(o,p){var c=o;for(var i=0,l=p.length;i<l;i++){c=c[p[i]];}return c;},onSearchButtonPressed:function(){this.oMyView.setBusy(true);if(this.sHierType==='CPS'){var c=this.oCurrSmartFilterBar.getFilterData(true).ValueDate;if(c){this.getPersonalSettings();}}else{c=this.oCurrSmartFilterBar.getFilterData(true).KeyDate;var s=null;if(this.sHierType==='BKH'){s=this.getView().byId("idCyclePatternForBA").getValue();}if(this.sHierType==='LQH'){s=this.getView().byId("idCyclePatternForLQ").getValue();if(this.aDrilldownfilter){var o=new sap.ui.generic.app.navigation.service.SelectionVariant(this.aDrilldownfilter);var f=new sap.ui.generic.app.navigation.service.SelectionVariant(this.oCurrSmartFilterBar.getDataSuiteFormat());if(o.getParameter("BankAccountGroup")){if(o.getParameter("BankAccountGroup")!==f.getParameter("BankAccountGroup")){f.removeSelectOption("SortOrder");f.addSelectOption("SortOrder","I","EQ","000%",null);this.oCurrSmartFilterBar.setDataSuiteFormat(f.toJSONString(),true);}}}}if(s&&c){this.getPersonalSettings();}var g=this.oCurrSmartFilterBar.getFilterData(true).DisplayCurrency;if(g&&!this.byId("exRateTypeFilter").getVisibleInAdvancedArea()){this.byId("exRateTypeFilter").setVisibleInAdvancedArea(true);}}},onNavBack:function(){var p=H.getInstance().getPreviousHash(),c=sap.ushell.Container.getService("CrossApplicationNavigation");if(p!==undefined||!c.isInitialNavigation()){history.go(-1);}else{this.getRouter().navTo("worklist",{},true);}},onExit:function(){},validateCyclePattern:function(o){var c=null;if(this.sHierType==='BKH'){c=this.getView().byId("idCyclePatternForBA");}if(this.sHierType==='LQH'){c=this.getView().byId("idCyclePatternForLQ");}var s=c.getValue().toUpperCase();c.setValue(s);var l=0;var r=new RegExp("^([D,W,M,Q,Y]([1-9]|([1-2][0-9])|(3[0-1])))$");c.setValueState("None");if(s){var f=s.split("+");for(var i=0;i<f.length;i++){if(r.test(f[i])===false){c.setValueState("Error");return;}l=l+(parseInt(f[i].substr(1,2),10));}}if(l>31){c.setValueState("Error");}},onInterNavigationPressed:function(o){if(!this._DrillDownPopover){this._DrillDownPopover=sap.ui.xmlfragment(this.getView().getId(),"fin.cash.flow.analyzer.view.fragment.NaviPopOverForBL",this);this.getView().addDependent(this._DrillDownPopover);}this._DrillDownPopover.open();if(o.getSource().getBindingContext()){this.oSelectedPath=o.getSource().getBindingContext().getPath();if(!this.existDisplayCurrency()){this.getView().byId("fin.cash.fa.bl-displaycurrency").setEnabled(true);}else{this.getView().byId("fin.cash.fa.bl-displaycurrency").setEnabled(false);this.getView().byId("fin.cash.fa.bl-displaycurrency").setValue(this.existDisplayCurrency());}}},existDisplayCurrency:function(){var f=this.oCurrSmartFilterBar.getFilters()[0];if(f._bMultiFilter===false){if(f.sPath==="DisplayCurrency"){return f.oValue1;}}else{var c=f.aFilters;for(var i=0;i<c.length;i++){if(c[i].sPath==="DisplayCurrency"){return c[i].oValue1;}}}if(!this.getView().getModel("Scaling").getData().displayCurrency){return false;}else{return this.getView().getModel("Scaling").getData().displayCurrency;}},_cancelSubmit:function(c){if(this._DrillDownPopover){this._DrillDownPopover.close();}},handleIntrNavigation:function(o){var s=new S(this.oCurrSmartFilterBar.getDataSuiteFormat());var n={};var l=this.getView().byId("fin.cash.fa.bl-id").getValue();var L=this.getView().byId("fin.cash.fa.bl-displaycurrency").getValue();if(!l){sap.m.MessageBox.show(this.oResourceBundle.getText("NVGERROR"),{icon:sap.m.MessageBox.Icon.ERROR,title:this.oResourceBundle.getText("NVGERRORTITLE"),actions:[sap.m.MessageBox.Action.OK]});return;}else{var c=this.oTreeTable.getModel().getProperty(this.oSelectedPath).sortid;var f=this.oTreeTable.getModel().getProperty(this.oSelectedPath).newDataNode;if(c){if(f===true){var g=c.lastIndexOf(".");c=c.substring(0,g);}s.addSelectOption("SortOrder","I","EQ",c,null);}s.addSelectOption("LiquidityHierarchyName","I","EQ",l,null);s.addParameter("ViewType","2");s.addParameter("CyclePattern",this.getView().byId("idCyclePatternForBA").getValue());s.addParameter("HistoricalTimeStamp",this.getView().byId("idHistoricalTimeStampForBA").getDateValue().toJSON());if(!L){sap.m.MessageBox.show(this.oResourceBundle.getText("NVGERROR"),{icon:sap.m.MessageBox.Icon.ERROR,title:this.oResourceBundle.getText("NVGERRORTITLE"),actions:[sap.m.MessageBox.Action.OK]});return;}else{s.addParameter("DisplayCurrency",L);}n={oDrilldownfilter:s.toJSONString()};this.getRouter().navTo("LiquidityItemHierarchy",{Params:JSON.stringify(n).toBase64URI()});}return;},handleLQValueHelp:function(o){if(!this._LQSDialog){this._LQSDialog=sap.ui.xmlfragment(this.getView().getId(),"fin.cash.flow.analyzer.view.fragment.LQDialog",this);this._LQSDialog.setModel(this.oDataModel);var t=this.getView().getModel("i18n");this._LQSDialog.setModel(t,"i18n");}this._LQSDialog.setMultiSelect(false);this._LQSDialog.setRememberSelections(true);this._LQSDialog.getBinding("items").filter([]);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this._LQSDialog);this._LQSDialog.open();},handleDsplyCrcyValueHelp:function(o){if(!this._HDsplyCrcyDialog){this._HDsplyCrcyDialog=sap.ui.xmlfragment(this.getView().getId(),"fin.cash.flow.analyzer.view.fragment.HDsplyCrcyDialog",this);this._HDsplyCrcyDialog.setModel(this.oDataModel);var t=this.getView().getModel("i18n");this._HDsplyCrcyDialog.setModel(t,"i18n");}this._HDsplyCrcyDialog.setMultiSelect(false);this._HDsplyCrcyDialog.setRememberSelections(true);this._HDsplyCrcyDialog.getBinding("items").filter([]);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this._HDsplyCrcyDialog);this._HDsplyCrcyDialog.open();},onHandleSearchForLQH:function(o){var f=[];var v=o.getParameter("value");var c=new sap.ui.model.Filter("HierarchyName",sap.ui.model.FilterOperator.Contains,v);f.push(c);var g=o.getSource().getBinding("items");g.filter(f);},onHandleSearchForBAH:function(o){var f=[];var v=o.getParameter("value");var c=new sap.ui.model.Filter("HierarchyName",sap.ui.model.FilterOperator.Contains,v);f.push(c);var g=o.getSource().getBinding("items");g.filter(f);},onHandleCloseForLQH:function(o){var c=o.getParameter("selectedContexts");var l=null;if(c.length){l=c.map(function(f){return f.getObject().HierarchyName;}).join(", ");}o.getSource().getBinding("items").filter([]);if(l!==null){this.getView().byId("fin.cash.fa.bl-id").setValue(l);}},onHandleCloseForHDC:function(o){var c=o.getParameter("selectedContexts");var l=null;if(c.length){l=c.map(function(f){return f.getObject().WAERS;}).join(", ");}o.getSource().getBinding("items").filter([]);if(l!==null){this.getView().byId("fin.cash.fa.bl-displaycurrency").setValue(l);}},onHandleSearchForHDC:function(o){var f=[];var v=o.getParameter("value");var c=new sap.ui.model.Filter("WAERS",sap.ui.model.FilterOperator.Contains,v);f.push(c);var g=o.getSource().getBinding("items");g.filter(f);},ExportExcel:function(){var p=this.oDataPath;var m=this.oDataModel;if(m){this.oMyView.setBusy(true);var f=this.oCurrSmartFilterBar.getFilters();var o=new sap.ui.model.Filter("Export","EQ","xlsx"+"::"+'X');f.push(o);if(this.sHierType!=="CPS"){this.setRequestFilters(f);}m.read(p,{filters:f,success:$.proxy(this.handleExportExcelReady,this),error:$.proxy(this.handleMyTableDataFailed,this)});}},handleExportExcelReady:function(D){this.oMyView.setBusy(false);var p=D["results"][0].Content;var f=new Uint8Array(this.decodeFromBase64(p).split("").map(function(c){return c.charCodeAt(0);}));var g=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});sap.ui.core.util.File.save(g,"download","xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","utf-8");},decodeFromBase64:function(i){i=i.replace(/\s/g,'');return atob(i);},onHandleAfterVariantLoad:function(o){var D=this.oCurrSmartFilterBar.getFilterData();var c=D["_CUSTOM"];this.oCurrSmartFilterBar.getControlByKey("CyclePattern").setValue(c.CyclePattern);if(c.HistoricalTimeStamp){this.oCurrSmartFilterBar.getControlByKey("HistoricalTimeStamp").setDateValue(new Date(Date.parse(c.HistoricalTimeStamp)));}else{this.oCurrSmartFilterBar.getControlByKey("HistoricalTimeStamp").setDateValue(this.util.getHistoryDateTimeDefault());}},onHandleBeforeVariantSave:function(o){var c=null;var h=null;switch(this.sHierType){case'BKH':c=this.getView().byId("idCyclePatternForBA").getValue();h=this.getView().byId("idHistoricalTimeStampForBA").getDateValue();break;case'LQH':c=this.getView().byId("idCyclePatternForLQ").getValue();h=this.getView().byId("idHistoricalTimeStampForLQ").getDateValue();break;}if(c!==""){this.oCurrSmartFilterBar.setFilterData({_CUSTOM:{CyclePattern:c,HistoricalTimeStamp:h}});}},onShareButtonPressed:function(o){if(!this.oShareActionSheet){this.oShareActionSheet=sap.ui.xmlfragment(this.getView().getId(),"fin.cash.flow.analyzer.view.fragment.shareActionSheet",this);this.getView().addDependent(this.oShareActionSheet);}var s=new J();this.setModel(s,"share");this.oShareActionSheet.setModel(s,"share");s.setProperty("/bookmarkTitle",this.oResourceBundle.getText("appDescription"));s.setProperty("/bookmarkButtonText",this.oResourceBundle.getText("SEMANTIC_CONTROL_SAVE_AS_TILE"));var g=jQuery.sap.getObject("sap.ushell.Container.getUser");s.setProperty("/jamVisible",!!g&&g().isJamActive());s.setProperty("/bookmarkCustomUrl",this.generateCustomUrl());this.oShareActionSheet.openBy(o.getSource());},onAssignedFiltersChanged:function(o){switch(this.sHierType){case"BKH":this.byId("BkhFilterText").setText(this.byId("smartFilterBarItemForBA").retrieveFiltersWithValuesAsText());break;case"LQH":this.byId("LqhFilterText").setText(this.byId("smartFilterBarItemForLQ").retrieveFiltersWithValuesAsText());break;case"CPS":this.byId("CpsFilterText").setText(this.byId("smartFilterBarItemForCPSim").retrieveFiltersWithValuesAsText());break;}},onToggleHeaderPressed:function(o){var p=this.getView().getModel("page");p.setProperty("/headerExpanded",(p.getProperty("/headerExpanded")===true)?false:true);},formatToggleButtonText:function(v){return v?this.getResourceBundle().getText("HIDE_FILTERS"):this.getResourceBundle().getText("SHOW_FILTERS");}});});
